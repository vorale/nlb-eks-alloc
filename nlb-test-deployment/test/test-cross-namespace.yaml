apiVersion: v1
kind: Namespace
metadata:
  name: game-ns

---
apiVersion: v1
kind: Pod
metadata:
  name: game-server-room-1
  namespace: game-ns
  labels:
    app: game-server
    room: "room-1"
spec:
  containers:
  - name: game-server
    image: nginx:alpine
    ports:
    - containerPort: 7777
    env:
    - name: ROOM_ID
      value: "room-1"
    command: ["/bin/sh"]
    args:
    - -c
    - |
      echo "Game Server Room 1 - Port: 7777" > /usr/share/nginx/html/index.html
      echo "Room ID: room-1" >> /usr/share/nginx/html/index.html
      echo "Pod Name: game-server-room-1" >> /usr/share/nginx/html/index.html
      echo "Namespace: game-ns" >> /usr/share/nginx/html/index.html
      echo "Pod IP: $(hostname -i)" >> /usr/share/nginx/html/index.html
      nginx -g 'daemon off;'

---
apiVersion: v1
kind: Service
metadata:
  name: game-room-1-service
  namespace: default
  annotations:
    nlb.port-manager/auto-assign: "true"
    nlb.port-manager/target-pod: "game-server-room-1"
    nlb.port-manager/target-namespace: "game-ns"
  labels:
    app: game-service
spec:
  ports:
  - name: game
    protocol: TCP
    port: 7777
    targetPort: 7777
  # Service 在 default 命名空间，但绑定到 game-ns 命名空间的 Pod
